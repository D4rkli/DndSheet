<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DnD Sheet</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="styles.css?v=101" />

  <script src="https://telegram.org/js/telegram-web-app.js?v=101"></script>
</head>
<body>
<div class="wrap">
  <header class="topbar">
    <div class="d-flex align-items-center justify-content-between gap-2">
      <div class="min-w-0">
        <div class="app-title">üßô –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
        <div id="status" class="muted">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ‚Ä¶</div>
      </div>
      <div class="d-flex gap-2">
        <button id="btnExport" class="btn btn-sm btn-outline-light">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="btnImport" class="btn btn-sm btn-outline-light">–ò–º–ø–æ—Ä—Ç</button>
        <button id="btnSync" class="btn btn-sm btn-outline-light">–°–∏–Ω—Ö—Ä.</button>
        <button id="btnTemplates" class="btn btn-sm btn-light">–®–∞–±–ª–æ–Ω—ã</button>
      </div>
    </div>

    <div class="mt-2 d-flex gap-2">
      <select id="characterSelect" class="form-select form-select-sm"></select>
      <button id="btnNew" class="btn btn-sm btn-light">+ –ù–æ–≤—ã–π</button>
    </div>
  </header>

    <!-- FAB (+) -->
  <button id="fabAdd" class="fab d-none" type="button" aria-label="–î–æ–±–∞–≤–∏—Ç—å">
    <i class="bi bi-plus-lg"></i>
  </button>

  <!-- FAB menu -->
  <div id="fabMenu" class="fab-menu d-none" role="menu" aria-label="–ú–µ–Ω—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è">
    <button class="fab-item" type="button" data-action="add-spell">
      <i class="bi bi-stars"></i><span>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ</span>
    </button>
    <button class="fab-item" type="button" data-action="add-ability">
      <i class="bi bi-lightning-charge"></i><span>–£–º–µ–Ω–∏–µ</span>
    </button>
    <button class="fab-item" type="button" data-action="add-item">
      <i class="bi bi-backpack"></i><span>–ü—Ä–µ–¥–º–µ—Ç</span>
    </button>
    <button class="fab-item" type="button" data-action="add-state">
      <i class="bi bi-activity"></i><span>–°–æ—Å—Ç–æ—è–Ω–∏–µ</span>
    </button>
  </div>

  <main class="content">
    <ul class="nav nav-pills small sticky-tabs" id="tabs">
      <li class="nav-item"><button class="nav-link active" data-tab="main"><i class="bi bi-person-badge"></i><span>–û—Å–Ω–æ–≤–Ω–æ–µ</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="stats"><i class="bi bi-bar-chart"></i><span>–°—Ç–∞—Ç—ã</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="inv"><i class="bi bi-backpack"></i><span>–ò–Ω–≤.</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="spells"><i class="bi bi-stars"></i><span>–ó–∞–∫–ª.</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="abilities"><i class="bi bi-lightning-charge"></i><span>–£–º.</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="states"><i class="bi bi-activity"></i><span>–°–æ—Å—Ç.</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="equip"><i class="bi bi-shield"></i><span>–≠–∫–∏–ø.</span></button></li>
      <li class="nav-item"><button class="nav-link" data-tab="custom"><i class="bi bi-sliders"></i><span>–ü–æ–ª—è</span></button></li>
    </ul>

    <!-- MAIN -->
    <section class="tab" id="tab-main">
      <div class="card card-soft">
        <div class="card-body">
          <div class="row g-2">
            <div class="col-12">
              <label class="form-label">–ò–º—è</label>
              <input id="f_name" class="form-control" placeholder="–ù–∞–ø—Ä. –≠–ª–≤–∏–Ω" />
            </div>
            <div class="col-6">
              <label class="form-label">–†–∞—Å–∞</label>
              <input id="f_race" class="form-control" placeholder="–≠–ª—å—Ñ" />
            </div>
            <div class="col-6">
              <label class="form-label">–ö–ª–∞—Å—Å</label>
              <input id="f_klass" class="form-control" placeholder="–ü–ª—É—Ç" />
            </div>
            <div class="col-6">
              <label class="form-label">–ü–æ–ª</label>
              <input id="f_gender" class="form-control" placeholder="" />
            </div>
            <div class="col-3">
              <label class="form-label">–£—Ä–æ–≤–µ–Ω—å</label>
              <input id="f_level" type="number" class="form-control" min="1" />
            </div>
            <div class="col-3">
              <label class="form-label">XP</label>
              <input id="f_xp" type="number" class="form-control" min="0" />
            </div>
          </div>

          <hr class="hr-soft" />

          <div class="row g-2 resources-grid">
            <div class="col-12"><div class="section-title">–†–µ—Å—É—Ä—Å—ã</div></div>

            <div class="col-12 col-md-4">
              <label class="form-label">HP</label>
              <div class="resource">
                <div class="resource-main">
                  <button class="btn step-btn" type="button" data-target="f_hp" data-step="-1">‚àí</button>
                  <input id="f_hp" type="number" class="form-control text-center" />
                  <button class="btn step-btn" type="button" data-target="f_hp" data-step="1">+</button>
                </div>

                <div class="resource-max">
                  <input id="f_hp_max" type="number" class="form-control" placeholder="–ú–∞–∫—Å" />
                </div>
              </div>


            <div class="col-12 col-md-4">
              <label class="form-label">–ú–∞–Ω–∞</label>
              <div class="resource">
                <div class="resource-main">
                  <button class="btn step-btn" data-target="f_mana" data-step="-1">‚àí</button>
                  <input id="f_mana" type="number" class="form-control text-center" />
                  <button class="btn step-btn" data-target="f_mana" data-step="1">+</button>
                </div>

                <div class="resource-max">
                  <input id="f_mana_max" type="number" class="form-control" placeholder="–ú–∞–∫—Å" />
                </div>
              </div>

            <div class="col-12 col-md-4">
              <label class="form-label">–≠–Ω–µ—Ä–≥–∏—è</label>
              <div class="resource">
                <div class="resource-main">
                  <button class="btn step-btn" data-target="f_energy" data-step="-1">‚àí</button>
                  <input id="f_energy" type="number" class="form-control text-center" />
                  <button class="btn step-btn" data-target="f_energy" data-step="1">+</button>
                </div>

                <div class="resource-max">
                  <input id="f_energy_max" type="number" class="form-control" placeholder="–ú–∞–∫—Å" />
                </div>
              </div>

          <div class="d-grid mt-3">
            <button id="btnSaveMain" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </div>
      </div>

      <div class="card card-soft mt-3">
        <div class="card-body">
          <div class="section-title">–ü—Ä–∞–≤–∏–ª–∞ –ª–µ–≤–µ–ª-–∞–ø–∞ / –∑–∞–º–µ—Ç–∫–∏ DM</div>
          <textarea id="f_level_up_rules" class="form-control" rows="5" placeholder="–ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è‚Ä¶"></textarea>
          <div class="d-grid mt-2">
            <button id="btnSaveRules" class="btn btn-outline-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
          </div>
        </div>
      </div>
      </section>

    <!-- STATS -->
    <section class="tab d-none" id="tab-stats">
      <div class="card card-soft">
        <div class="card-body">
          <div class="section-title">–•–∞—Ä–∞–∫—Ç–µ—Ä</div>
          <div class="grid-2" id="statsPersonality"></div>

          <hr class="hr-soft" />

          <div class="section-title">–ë–æ–π</div>
          <div class="grid-2" id="statsCombat"></div>

          <div class="d-grid mt-3">
            <button id="btnSaveStats" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—ã</button>
          </div>
        </div>
      </div>
    </section>

    <!-- INVENTORY -->
    <section class="tab d-none" id="tab-inv">
      <div class="card card-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title mb-0">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            <button id="btnAddItem" class="btn btn-sm btn-light"><i class="bi bi-plus-lg me-1"></i>–ü—Ä–µ–¥–º–µ—Ç</button>
          </div>
          <div id="invList" class="list mt-2"></div>
        </div>
      </div>
    </section>

    <!-- SPELLS -->
    <section class="tab d-none" id="tab-spells">
      <div class="card card-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title mb-0">–ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è</div>
            <button id="btnAddSpell" class="btn btn-sm btn-light"><i class="bi bi-plus-lg me-1"></i>–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ</button>
          </div>
          <div id="spellsList" class="list mt-2"></div>
        </div>
      </div>
    </section>

    <!-- ABILITIES -->
    <section class="tab d-none" id="tab-abilities">
      <div class="card card-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title mb-0">–£–º–µ–Ω–∏—è</div>
            <button id="btnAddAbility" class="btn btn-sm btn-light"><i class="bi bi-plus-lg me-1"></i>–£–º–µ–Ω–∏–µ</button>
          </div>
          <div id="abilitiesList" class="list mt-2"></div>
        </div>
      </div>
    </section>

    <!-- STATES -->
    <section class="tab d-none" id="tab-states">
      <div class="card card-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div class="section-title mb-0">–°–æ—Å—Ç–æ—è–Ω–∏—è</div>
            <button id="btnAddState" class="btn btn-sm btn-light"><i class="bi bi-plus-lg me-1"></i>–°–æ—Å—Ç–æ—è–Ω–∏–µ</button>
          </div>
          <div id="statesList" class="list mt-2"></div>
        </div>
      </div>
    </section>

    <!-- EQUIPMENT -->
    <section class="tab d-none" id="tab-equip">
      <div class="card card-soft">
        <div class="card-body">
          <div class="section-title">–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</div>
          <div class="grid-2" id="equipGrid"></div>
          <div class="d-grid mt-3">
            <button id="btnSaveEquip" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CUSTOM FIELDS -->
    <section class="tab d-none" id="tab-custom">
      <div class="card card-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="section-title mb-0">–ü–æ–ª—è</div>
              <div class="hint">–ü–æ–ª—è –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ç–∞—Ç–æ–≤.</div>
            </div>
            <button id="btnSaveCustom" class="btn btn-primary btn-sm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
          <div id="customRoot" class="mt-3"></div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- MODAL -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-primary" id="modalSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<!-- JSON MODAL (Export / Import) -->
<div class="modal fade" id="jsonModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="jsonModalTitle">JSON</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label class="form-label" id="jsonModalLabel">–î–∞–Ω–Ω—ã–µ</label>
        <textarea id="jsonTextarea" class="form-control" rows="10" placeholder="–í—Å—Ç–∞–≤—å JSON —Å—é–¥–∞..."></textarea>
        <div class="hint mt-2" id="jsonHint"></div>
        <div class="mt-2" id="jsonExtra"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button type="button" class="btn btn-primary" id="jsonActionBtn">–û–∫</button>
      </div>
    </div>
  </div>
</div>

<!-- TEMPLATES MODAL -->
<div class="modal fade" id="templatesModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–®–∞–±–ª–æ–Ω—ã</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="section-title">–°–ø–∏—Å–æ–∫</div>
        <div id="templatesList"></div>
        <hr class="hr-soft" />
        <div class="section-title">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input id="tplName" class="form-control" placeholder="–ù–∞–ø—Ä. D&D –±–∞–∑–æ–≤—ã–π" />
        <div class="hint mt-2">–ß—Ç–æ –ø–æ–ø–∞–¥—ë—Ç –≤ —à–∞–±–ª–æ–Ω: –∫–∞–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ WebApp (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å).
          –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ —à–∞–±–ª–æ–Ω –Ω–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è.</div>
        <div class="mt-2" id="tplTabs"></div>

        <label class="form-label mt-3">–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è (JSON, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <textarea id="tplCustomSections" class="form-control" rows="6" placeholder='{"custom_sections":[{"title":"–ë–∏–æ–≥—Ä–∞—Ñ–∏—è","fields":[{"key":"bio","label":"–ë–∏–æ","type":"textarea"}]}]}'></textarea>
        <div class="hint mt-1">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, —Å–æ–∑–¥–∞—Å—Ç—Å—è —à–∞–±–ª–æ–Ω —Ç–æ–ª—å–∫–æ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏. –î–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π —É–∫–∞–∂–∏ custom_sections.</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button type="button" class="btn btn-primary" id="btnCreateTpl">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="app.js"></script>
</body>
</html>
